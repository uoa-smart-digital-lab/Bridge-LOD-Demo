/**********************************************************************************************************************************************************
 * XRData_Calc
 * -----------
 *
 * 2021-09-27
 *
 * Add, Subtract, Divide or Multiply a set amount to / from two XRData floats.  An output event is only sent once both values have been set.
 *
 * Roy Davies, Smart Digital Lab, University of Auckland.
 **********************************************************************************************************************************************************/

using System.Collections;
using System.Collections.Generic;
using UnityEngine;

// ----------------------------------------------------------------------------------------------------------------------------------------------------------
// Public functions
// ----------------------------------------------------------------------------------------------------------------------------------------------------------
public interface IXRData_Calc
{
    void InputA(XRData data);
    void InputB(XRData data);
}
// ----------------------------------------------------------------------------------------------------------------------------------------------------------



// ----------------------------------------------------------------------------------------------------------------------------------------------------------
// Main class
// ----------------------------------------------------------------------------------------------------------------------------------------------------------
[AddComponentMenu("OpenXR UX/Connectors/XRData Calc")]
public class XRData_Calc : MonoBehaviour, IXRData_Calc
{
    public enum operation {plus, minus, divided_by, times}
    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    // Public variables
    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    public operation op = operation.plus;
    public UnityXRDataEvent onChange;
    // ------------------------------------------------------------------------------------------------------------------------------------------------------



    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    // Private variables
    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    private float storedA, storedB = 0.0f;
    private bool setA, setB = false;
    // ------------------------------------------------------------------------------------------------------------------------------------------------------



    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    // Send answer
    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    public void InputA(XRData data)
    {
        storedA = data.ToFloat();
        setA = true;
        if ((onChange != null) && setA && setB)
        {
            onChange.Invoke(new XRData(DoCalc(storedA, op, storedB)));
        }
    }
    public void InputB(XRData data)
    {
        storedB = data.ToFloat();
        setB = true;
        if ((onChange != null) && setA && setB)
        {
            onChange.Invoke(new XRData(DoCalc(storedA, op, storedB)));
        }
    }
    // ------------------------------------------------------------------------------------------------------------------------------------------------------



    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    // Do the calculation
    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    private float DoCalc(float A, operation op, float B)
    {
        switch (op)
        {
            case operation.plus:
                return (A + B);
            case operation.minus:
                return (A - B);
            case operation.divided_by:
                return (A / B); // Wach out for divide-by-zero errors.
            default:
                return (A * B);
        }
    }
    // ------------------------------------------------------------------------------------------------------------------------------------------------------
}
