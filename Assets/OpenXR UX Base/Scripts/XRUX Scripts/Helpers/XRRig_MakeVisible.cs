/******************************************************************************************************************************************************
 * XRRig_MakeVisible
 * -----------------
 *
 * 2021-08-25
 * 
 * Reacts to events and makes the gameobject the script is sitting on active or inactive.  This has the effect of making it visible or
 * invisible.
 * 
 * Roy Davies, Smart Digital Lab, University of Auckland.
 ******************************************************************************************************************************************************/

using System.Collections;
using System.Collections.Generic;
using UnityEngine;

// ------------------------------------------------------------------------------------------------------------------------------------------------------
// Public functions
// ------------------------------------------------------------------------------------------------------------------------------------------------------
public interface IXRRig_MakeVisible
{
    void Input(XRData newdata);             // Make visible on XRData Boolean true or false
}
// ------------------------------------------------------------------------------------------------------------------------------------------------------



// ------------------------------------------------------------------------------------------------------------------------------------------------------
// Main class
// ------------------------------------------------------------------------------------------------------------------------------------------------------
public class XRRig_MakeVisible : MonoBehaviour, IXRRig_MakeVisible
{
    // --------------------------------------------------------------------------------------------------------------------------------------------------
    // Public variables
    // --------------------------------------------------------------------------------------------------------------------------------------------------
    public bool activateOnEvent = true;
    public XRDeviceEventTypes eventToWatchFor;
    public XRDeviceActions actionToWatchFor;
    // --------------------------------------------------------------------------------------------------------------------------------------------------



    // --------------------------------------------------------------------------------------------------------------------------------------------------
    // Private variables
    // --------------------------------------------------------------------------------------------------------------------------------------------------

    // --------------------------------------------------------------------------------------------------------------------------------------------------


    // --------------------------------------------------------------------------------------------------------------------------------------------------
    // Set up the variables ready to go.
    // --------------------------------------------------------------------------------------------------------------------------------------------------
    void Start()
    {
        // Listen for events coming from the XR Controllers and other devices
        if (XRRig.EventQueue != null) XRRig.EventQueue.AddListener(onButtonEvent);

        // Start with the object being inactive / invisible
        if (this.gameObject != null) this.gameObject.SetActive(false);
    }
    // --------------------------------------------------------------------------------------------------------------------------------------------------



    // --------------------------------------------------------------------------------------------------------------------------------------------------
    // Make the object visible or invisible.
    // --------------------------------------------------------------------------------------------------------------------------------------------------
    public void onButtonEvent(XREvent theEvent)
    {
        if ((theEvent.eventType == eventToWatchFor) && (theEvent.eventAction == actionToWatchFor) && activateOnEvent)
        {
            if (this.gameObject != null) this.gameObject.SetActive(theEvent.eventBool);
        }
    }
    // --------------------------------------------------------------------------------------------------------------------------------------------------



    // --------------------------------------------------------------------------------------------------------------------------------------------------
    // Make object visible or invisible on XRData event
    // --------------------------------------------------------------------------------------------------------------------------------------------------
    public void Input(XRData data)
    {
        this.gameObject.SetActive(data.ToBool());
    }
    // --------------------------------------------------------------------------------------------------------------------------------------------------
}
