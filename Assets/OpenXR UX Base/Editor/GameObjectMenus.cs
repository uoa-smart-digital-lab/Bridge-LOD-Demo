/**********************************************************************************************************************************************************
 * GameObjectMenus
 * ---------------
 *
 * 2021-10-14
 *
 * Set up the menus for adding gameobjects, components, and the tags and layers.
 *
 * Roy Davies, Smart Digital Lab, University of Auckland.
 **********************************************************************************************************************************************************/
 
using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEditor;
using System;

// ----------------------------------------------------------------------------------------------------------------------------------------------------------
// Main class
// ----------------------------------------------------------------------------------------------------------------------------------------------------------
public class GameObjectMenus : MonoBehaviour
{
    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    // Set up the tags and layers required by OpenXR UX
    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    private static void SetUpTagsAndLayers()
    {
        // Open tag manager
        SerializedObject tagManager = new SerializedObject(AssetDatabase.LoadAllAssetsAtPath("ProjectSettings/TagManager.asset")[0]);
        SerializedProperty tagsProp = tagManager.FindProperty("tags");
        SerializedProperty layersProp = tagManager.FindProperty("layers");

        // Check and add Tags as appropriate
        foreach (string tagName in Enum.GetNames(typeof(OpenXR_UX_Tags)))
        {
            // check if the tag is defined
            bool found = false;
            for (int i = 0; i < tagsProp.arraySize; i++)
            {
                SerializedProperty tagProperty = tagsProp.GetArrayElementAtIndex(i);
                if (tagProperty.stringValue.Equals(tagName)) { found = true; break; }
            }

            // if not found, add it
            if (!found)
            {
                tagsProp.InsertArrayElementAtIndex(0);
                SerializedProperty tagProperty = tagsProp.GetArrayElementAtIndex(0);
                tagProperty.stringValue = tagName;
            }
        }

        // Set the Layers
        foreach (int layerValue in Enum.GetValues(typeof(OpenXR_UX_Layers)))
        {
            SerializedProperty layerProperty = layersProp.GetArrayElementAtIndex(layerValue);
            layerProperty.stringValue = Enum.GetName(typeof(OpenXR_UX_Layers), layerValue);
        } 

        // Save changes
        tagManager.ApplyModifiedPropertiesWithoutUndo();
    }
    // ------------------------------------------------------------------------------------------------------------------------------------------------------



    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    // Helper function to create a GameObject from a given prefab
    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    private static void CreateObjectFromPrefab(string Location, string Name)
    {
        GameObject prefab = (GameObject)PrefabUtility.InstantiatePrefab(AssetDatabase.LoadAssetAtPath<UnityEngine.Object>(Location));
        prefab.name = Name;

        if(Selection.activeTransform != null)
        {
            prefab.transform.SetParent(Selection.activeTransform, false);
        }
        prefab.transform.localPosition = Vector3.zero;
        prefab.transform.localEulerAngles = Vector3.zero;
        prefab.transform.localScale = Vector3.one;

        Selection.activeGameObject = prefab;
    }
    // ------------------------------------------------------------------------------------------------------------------------------------------------------



    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    // Convert the main camera to an XRRig with UX
    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    [MenuItem("GameObject/OpenXR UX/Convert Main Camera To XR Rig With UX")]
    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    private static void ConvertMainCameraToXRRigWithUX()
    {
        SetUpTagsAndLayers();

        Camera mainCamera = Camera.main;
        if (mainCamera != null)
        {
            if ((mainCamera.gameObject.transform.root == mainCamera.gameObject.transform) ||
            (mainCamera.gameObject.transform.root.name.Contains("XRRig")))
            {
                Debug.Log("Replacing Main Camera with XRRig with UX");
                DestroyImmediate(mainCamera.gameObject.transform.root.gameObject);
                CreateObjectFromPrefab("Assets/OpenXR UX Base/Prefabs/XRRig with UX.prefab", "XRRig with UX");
            }
            else
            {
                Debug.LogError("Cannot convert Main Camera GameObject - try deleting it first.");
            }
        }
        else
        {
            Debug.Log("No Main Camera - creating one.");
            CreateObjectFromPrefab("Assets/OpenXR UX Base/Prefabs/XRRig with UX.prefab", "XRRig with UX");
        }
    }
    // ------------------------------------------------------------------------------------------------------------------------------------------------------



    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    // ENTRY
    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    [MenuItem ("GameObject/OpenXR UX/XR Modules/XR ENTRY")]
    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    private static void CreateXRENTRY ()
    {
        CreateObjectFromPrefab("Assets/OpenXR UX Base/Prefabs/XR ENTRY.prefab", "ENTRY");
    }
    // ------------------------------------------------------------------------------------------------------------------------------------------------------



    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    // XR Button Group
    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    [MenuItem ("GameObject/OpenXR UX/XR Modules/XR Button Group")]
    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    private static void CreateXRRadioButtons ()
    {
        CreateObjectFromPrefab("Assets/OpenXR UX Base/Prefabs/XR Button Group.prefab", "XR Button Group");
    }
    // ------------------------------------------------------------------------------------------------------------------------------------------------------



    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    // XR Button
    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    [MenuItem ("GameObject/OpenXR UX/XR Modules/XR Buttons/XR Button")]
    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    private static void CreateXRButton ()
    {
        CreateObjectFromPrefab("Assets/OpenXR UX Base/Prefabs/XR Button.prefab", "XR Button");
    }
    // ------------------------------------------------------------------------------------------------------------------------------------------------------



    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    // XR Cancel Button
    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    [MenuItem ("GameObject/OpenXR UX/XR Modules/XR Buttons/XR Cancel Button")]
    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    private static void CreateXRCancelButton ()
    {
        CreateObjectFromPrefab("Assets/OpenXR UX Base/Prefabs/XR Cancel Button.prefab", "XR Cancel Button");
    }
    // ------------------------------------------------------------------------------------------------------------------------------------------------------



    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    // XR OK Button
    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    [MenuItem ("GameObject/OpenXR UX/XR Modules/XR Buttons/XR OK Button")]
    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    private static void CreateXROKButton ()
    {
        CreateObjectFromPrefab("Assets/OpenXR UX Base/Prefabs/XR OK Button.prefab", "XR OK Button");
    }
    // ------------------------------------------------------------------------------------------------------------------------------------------------------



    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    // XR Square Button
    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    [MenuItem ("GameObject/OpenXR UX/XR Modules/XR Buttons/XR Square Button")]
    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    private static void CreateXRSquareButton ()
    {
        CreateObjectFromPrefab("Assets/OpenXR UX Base/Prefabs/XR Square Button.prefab", "XR Square Button");
    }
    // ------------------------------------------------------------------------------------------------------------------------------------------------------



    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    // XR Console
    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    [MenuItem ("GameObject/OpenXR UX/XR Modules/XR Console")]
    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    private static void CreateXRConsole ()
    {
        CreateObjectFromPrefab("Assets/OpenXR UX Base/Prefabs/XR Console.prefab", "XR Console");
    }
    // ------------------------------------------------------------------------------------------------------------------------------------------------------



    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    // XR Inputfield
    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    [MenuItem ("GameObject/OpenXR UX/XR Modules/XR Inputfield")]
    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    private static void CreateXRInputfield ()
    {
        CreateObjectFromPrefab("Assets/OpenXR UX Base/Prefabs/XR Inputfield.prefab", "XR Inputfield");
    }
    // ------------------------------------------------------------------------------------------------------------------------------------------------------



    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    // XR Keyboard
    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    [MenuItem ("GameObject/OpenXR UX/XR Modules/XR Keyboard")]
    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    private static void CreateXRKeyboard ()
    {
        CreateObjectFromPrefab("Assets/OpenXR UX Base/Prefabs/XR Keyboard.prefab", "XR Keyboard");
    }
    // ------------------------------------------------------------------------------------------------------------------------------------------------------



    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    // XR Knob
    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    [MenuItem ("GameObject/OpenXR UX/XR Modules/XR Knob")]
    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    private static void CreateXRKnob ()
    {
        CreateObjectFromPrefab("Assets/OpenXR UX Base/Prefabs/XR Knob.prefab", "XR Knob");
    }
    // ------------------------------------------------------------------------------------------------------------------------------------------------------



    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    // XR Radio Button
    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    [MenuItem ("GameObject/OpenXR UX/XR Modules/XR Radio Button")]
    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    private static void CreateXRRadioButton ()
    {
        CreateObjectFromPrefab("Assets/OpenXR UX Base/Prefabs/XR Radio Button.prefab", "XR Radio Button");
    }
    // ------------------------------------------------------------------------------------------------------------------------------------------------------



    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    // XR Slider Switch
    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    [MenuItem ("GameObject/OpenXR UX/XR Modules/XR Slider Switch")]
    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    private static void CreateXRSliderSwitch ()
    {
        CreateObjectFromPrefab("Assets/OpenXR UX Base/Prefabs/XR Slider Switch.prefab", "XR Slider Switch");
    }
    // ------------------------------------------------------------------------------------------------------------------------------------------------------



    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    // XR Textfield
    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    [MenuItem ("GameObject/OpenXR UX/XR Modules/XR Textfield")]
    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    private static void CreateXRTextfield ()
    {
        CreateObjectFromPrefab("Assets/OpenXR UX Base/Prefabs/XR Textfield.prefab", "XR Textfield");
    }
    // ------------------------------------------------------------------------------------------------------------------------------------------------------



    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    // XR Toggle Button
    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    [MenuItem ("GameObject/OpenXR UX/XR Modules/XR Toggle Button")]
    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    private static void CreateXRToggleButton ()
    {
        CreateObjectFromPrefab("Assets/OpenXR UX Base/Prefabs/XR Toggle Button.prefab", "XR Toggle Button");
    }
    // ------------------------------------------------------------------------------------------------------------------------------------------------------



    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    // XR UI Base
    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    [MenuItem ("GameObject/OpenXR UX/XR Modules/XR UI Base")]
    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    private static void CreateXRUIBase ()
    {
        CreateObjectFromPrefab("Assets/OpenXR UX Base/Prefabs/XR UI Base.prefab", "XR UI Base");
    }
    // ------------------------------------------------------------------------------------------------------------------------------------------------------



    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    // XR Portal
    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    [MenuItem ("GameObject/OpenXR UX/XR Modules/XR Portal")]
    // ------------------------------------------------------------------------------------------------------------------------------------------------------
    private static void CreateXRPortal ()
    {
        CreateObjectFromPrefab("Assets/OpenXR UX Base/Prefabs/XR Portal.prefab", "XR Portal");
    }  
    // ------------------------------------------------------------------------------------------------------------------------------------------------------
}
// ----------------------------------------------------------------------------------------------------------------------------------------------------------
